<!DOCTYPE html>
<html> 
<head> 
	<title>Практическая часть</title> 
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<link rel="stylesheet" href="style.css" type="text/css" media="screen">
</head> 
<body>
	<ul id="nav">
      <li><a href="index.html">Главная</a></li>
      <li><a href="author.html">Об авторе</a></li>
      <li><a href="head.html">О руководителе</a></li>
      <li><a href="theory.html">Теоретическая часть</a></li>
      <li><a class="current" href="practice.html">Практическая часть</a></li>
      <li><a href="sources.html">Список источников</a></li>
   	</ul>
	<div id='content'>
		<h1>
			Практическая часть
		</h1>
		<h2>
			Разработка аппаратной части системы
		</h2>
		<p>
			Упрощённая схема электрическая упрощённая представлена на рис.1. По структурной схеме видно, что все периферийные устройства подключены к микроконтроллеру. Микроконтроллер должен поддерживать WiFi интерфейс. Из периферии можно выделить:
			<ul>
				<li>Модуль тепловизионный;</li>
				<li>Акселерометр/Гироскоп/Магнитометр. Предназначен для возможности реализации компаса. Компас необходим для удобства пользования и определения положения тепловизора;</li>
				<li>Постоянное запоминающее устройство;</li>
			</ul>
		</p>
		<div id='centred'>
			<img src="resources/practice/diagram1.png">
			<br>
			<br>
			Рисунок 1 - Схема электрическая структурная
		</div>		
		<p>
			В качестве тепловизионной матрицы была выбрана Flir Lepton. Flir Lepton это длинноволновая инфракрасная микроболометрическая матрица с разрешением 80х60 пикселей, интегрированная с объективом с фиксированным фокусом и цифровым сигнальным процессором. С помощью цифрового сигнального процессора происходит коммутация пикселей к АЦП  и первичная обработка с матрицы. Первичная обработка заключается в удалении битых пикселей, удалению шума с изображения путём размытия и суммирования, компенсации дрейфа сопротивления  микроболометров в течении времени. Flir Lepton предоставляет возможность управления регистрами посредством интерфейса I2C, передачу видеопотока по интерфейсу SPI. Основные технические характеристики Flir Lepton представлены в таблице.
		</p>
		<table>
			<thead>
				<tr>
					<th>Параметр</th>
					<th>Значение</th>					
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>Технология матрицы</td>
					<td>Микроболометрическая</td>
				</tr>
				<tr>
					<td>Спектр, мкм</td>
					<td>8-14</td>
				</tr>
				<tr>
					<td>Разрешение матрицы, пикселей</td>
					<td>80х60</td>
				</tr>
				<tr>
					<td>Эффективная частота кадров, Гц</td>
					<td>28.6</td>
				</tr>
				<tr>
					<td>Чувствительность, °С</td>
					<td>0,050</td>
				</tr>
				<tr>
					<td>Угол обзора камеры, град.</td>
					<td>51</td>
				</tr>
				<tr>
					<td>Напряжение питания матрицы, В</td>
					<td>1.2</td>
				</tr>
				<tr>
					<td>Напряжение питания процессора, В</td>
					<td>2.8</td>
				</tr>
				<tr>
					<td>Потребляемая мощность, мВт</td>
					<td>4</td>
				</tr>
				<tr>
					<td>Диапазон рабочих температур, °С</td>
					<td>-10 - +65</td>
				</tr>
			</tbody>
		</table>
		<p>
			Схема подключения тепловизионной матрицы Flir Lepton представлена на рис. 2. 
		</p>
		<div id='centred'>
			<img src="resources/practice/diagram2.png">
			<br>
			<br>
			Рисунок 2 - Схема подключения Flir Lepton
		</div>	
		
		<h2>
			Разработка программной части системы
		</h2>
		
		<h3>
			Разработка программного обеспечения для микроконтроллера
		</h3>
		<p>
			Для работы устройства микроконтроллер должен решать следующие задачи:
			<ul>
				<li>Организовать работу с тепловизионным модулем Flir Lepton;</li>
				<li>приём видеопотока по VoSPI интерфейсу;</li>
				<li>считывание основных характеристик, таких как температура матрицы и корпуса модуля, тип установленной матрицы;</li>
				<li>управление затвором тепловизионного модуля для возможности компенсации теплового дрейфа сопротивления микроболометров и АЦП;</li>
				<li>Управление микросхемой акселерометра/гироскопа/магнитометра;</li>
				<li>Управление системой питания тепловизора;</li>
				<li>Организация передачи данных по WiFi;</li>
			</ul>
		</p>
		<p>
			Передача видеопотока от Flir Lepton осуществляется посредством интерфейса SPI. 
		</p>
		<p>
			SPI (англ. Serial Peripheral Interface, SPI bus — последовательный периферийный интерфейс, шина SPI) — последовательный синхронный стандарт передачи данных в режиме полного дуплекса, предназначенный для обеспечения простого и недорогого высокоскоростного сопряжения микроконтроллеров и периферии. SPI также иногда называют четырёхпроводным (англ. four-wire) интерфейсом.
		</p>
		<p>
			Поток VoSPI это просто непрерывная последовательность VoSPI кадров после события синхронизации. При условии, что синхронизация сохраняется, поток VoSPI может продолжаться до бесконечности. Следует отметить, что частота кадров потока номинально чуть ниже 27 Гц, тем не менее, скорость уникальных кадров чуть ниже 9 Гц. За каждым уникальным кадром следуют два дубликатами. 
		</p>
		<p>
			Разбор очереди будет происходить в отдельном высокоприоритетном потоке. Высокая приоритетность потока обусловлена тем, что протоколом VoSPI заданы жёсткие временные рамки и необходимо как можно больше уменьшить влияние других потоков. Алгоритм работы потока подготовки кадра для отправки показан на рисунке 3. Смысл его состоит в том, чтобы проигнорировать дублирующиеся пакеты  и кадры, а из полезных пакетов собрать полноценный кадр. Подготовленный кадр в дальнейшем будет отправлен по TCP клиенту. Данный поток запущен всё время, пока включено устройство. 
		</p>
		<div id='centred'>
			<img src="resources/practice/diagram3.png">
			<br>
			<br>
			Рисунок 3 - Схема алгоритма потока подготовки кадра для отправки 
		</div>	
	</div>
</body> 
</html>
